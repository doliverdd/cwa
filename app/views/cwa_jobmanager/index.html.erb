<h2>Job Manager</h2>
<center>
<div class="box" style="width:800px; text-align:left;">
<h3>My Jobs</h3>
<% if @jobs.count > 0 %>
  <table class="list">
    <tr>
      <td><b>Delete</b></td>
      <td><b>JobID</b></td>
      <td><b>Name</b></td>
      <td><b>Owner</b></td>
      <td><b>Slots</b></td>
      <td><b>Status</b></td>
      <td><b>Output Link</b></td>
    </tr>
  <% @jobs.each do |job| %>
    <% jobs_hist = CwaJobHistory.find_by_jobid(job.jobid) %>
    <% workdir = jobs_hist.workdir if jobs_hist != nil %>
    <tr>
      <td><%= button_to "X", { :action => 'delete', :jobid => job.jobid }, :confirm => "Are you sure you want to delete job #{job.jobid}?" %></td>
      <td><%= job.jobid %></td>
      <td><%= job.job_name %></td>
      <td><%= job.job_owner %></td>
      <td><%= job.slots %></td>
      <td><%= job.state %></td>
      <td>
        <% if workdir != nil %>
          <a href="<%= workdir %>">Link</a>
        <% else %>
          n/a
        <% end %>
      </td>
    </tr>
  <% end %>
  </table>
<% else %>
  <p>You have no submitted or running jobs.</p>
<% end %>
</div>

<div class="box" style="width:800px; text-align:left;">
<h3>Job History</h3>
<% hist_jobs = CwaJobHistory.find_all_by_owner(User.current.login).last(25).reverse %>
<% if hist_jobs.count > 0 %>
<table class="list">
  <tr>
    <td><b>Job Name</b></td>
    <td><b>JobID</b></td>
    <td><b>Output Link</b></td>
  </tr>
<% hist_jobs.each do |h| %>
  <% if @jobs.where_id_is(h.jobid) == nil %>
    <tr>
      <td><%= h.job_name %></td>
      <td><%= h.jobid %></td>
      <td><a href="<%= h.workdir %>">Link</a></td>
    </tr>
  <% end %>
<% end %>
</table>
<% else %>
<p>You have no jobs in your history</p>
<% end %>
</div>
</center>
